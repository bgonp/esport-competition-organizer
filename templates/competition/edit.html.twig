{% extends 'base.html.twig' %}

{% block content %}
<!--<a href="{{ path('competition_show', {id: competition.id}) }}">Go back</a>-->
<div class="row competition-title">
    <div class="col-12">
        <h1 class="text-center">Editar {{ competition.name }}</h1>
    </div>
</div>

{% if competition.isOpen %}
<form action="{{ path('competition_randomize') }}" method="POST" class="d-inline">
    <input type="hidden" name="competition_id" value="{{ competition.id }}">
    <button class="btn btn-lg btn-block btn-dark break-text-large my-3" type="submit">Asignar equipos!</button>
</form>
{% endif %}

{% if showFillButton %}
<form action="{{ path('competition_fill') }}" method="POST" class="d-inline">
    <input type="hidden" name="competition_id" value="{{ competition.id }}">
    <button class="btn btn-lg btn-block btn-dark break-text-large my-3" type="submit">Completar grupos</button>
</form>
{% endif %}

{% if not competition.isOpen %}
    {% include 'brackets/bracket_8.html.twig' %}
{% endif %}

<div class="row">
    <div class="col-md-12 col-lg-8 col-xl-6 border-0">
        <form method="post">
            <div class="card form-group border border-secondary p-3 custom-control custom-checkbox">
                <label for="inputName" class="sport-text-form">Nombre</label>
                <input type="text" value="{{ competition.name }}" name="name" id="inputName"
                    class="form-control mb-3 form-control-lg" autofocus required>

                <label for="inputDescription" class="sport-text-form">Descripción</label>
                <input type="text" value="{{ competition.description }}" name="description" id="inputDescription"
                    class="form-control mb-3 form-control-lg">

                {% if competition.isOpen %}
                <label for="inputTeamNum" class="sport-text-form">Número de Equipos</label>
                <select id="inputTeamNum" name="teamNum"
                    class="form-control col-12 mb-3 sport-text-form form-control-lg" required>
                    <option value="">Escoge...</option>
                    <option value="2"{{ competition|teamsNumber == 2 ? ' selected' : '' }}>2</option>
                    <option value="4"{{ competition|teamsNumber == 4 ? ' selected' : '' }}>4</option>
                    <option value="8"{{ competition|teamsNumber == 8 ? ' selected' : '' }}>8</option>
                    <option value="16"{{ competition|teamsNumber == 16 ? ' selected' : '' }}>16</option>
                </select>

                <label for="inputPlayersPerTeam" class="sport-text-form">Jugadores por Equipo</label>
                <input type="number" name="playersPerTeam" id="inputPlayersPerTeam"
                    class="form-control col-12 mb-3 form-control-lg sport-text-form" max="5" min="1" value="{{ competition.PlayersPerTeam }}" required>

                <label for="inputGame" class="sport-text-form">Juego</label>
                <select name="game" id="inputGame" class="form-control col-12 mb-3 sport-text-form form-control-lg" required>
                    <option value="">Escoge...</option>
                    {% for game in games %}
                    <option value="{{ game.id }}"{{ competition.game == game ? ' selected' : '' }}>{{ game.name }}</option>
                    {% endfor %}
                </select>

                <label for="dateAndTime" class="sport-text-form mb-3">Fecha y Hora</label>
                <input class="form-control mb-3 form-control-lg" type="datetime-local"
                       value="{{ competition.heldAt|toDateTimeFormat }}" id="dateAndTime" name="heldAt">
                {% endif %}

                <div class="custom-control custom-checkbox check">
                    <input type="checkbox" name="open" id="inputOpen"{{ competition.isOpen ? ' checked' : '' }}>
                    <label for="inputOpen" class="sport-text-form">Abierta</label>
                </div>

                <div class="custom-control custom-checkbox check">
                    <input type="checkbox" name="finished" id="inputFinished"{{ competition.isFinished ? ' checked' : '' }}>
                    <label for="inputFinished" class="sport-text-form">Finalizada</label>
                </div>

                <button class="btn btn-lg btn-dark break-text-large mt-3" type="submit">
                    Editar!
                </button>
            </div>
        </form>
    </div>

    <div id="chat" class="col-md-12 col-lg-8 col-xl-6 border-0">
        <form id="twitch_params">
            <div class="card form-group border border-secondary p-3">
                <input class="form-control mb-3 form-control-lg" type="hidden" name="competition_id"
                    value="{{ competition.id }}" />
                <label class="sport-text-form" for="inputBotName">Twitch bot name</label>
                <input class="form-control mb-3 form-control-lg" type="text"
                    id="inputBotName" name="twitch_bot_name" value="{{ competition.twitchBotName }}" />
                <label class="sport-text-form" for="inputBotToken">Twitch bot token</label>
                <input class="form-control mb-3 form-control-lg" type="text"
                    id="inputBotToken" name="twitch_bot_token" value="{{ competition.twitchBotToken }}" />
                <label class="sport-text-form" for="inputChannel">Twitch channel</label>
                <input class="form-control mb-3 form-control-lg" type="text"
                    id="inputChannel" name="twitch_channel" value="{{ competition.twitchChannel }}" />
                <button class="btn btn-lg btn-dark break-text-large mt-3" type="submit"{{ competition.isOpen ? '' : ' disabled' }}>
                    Abrir confirmaciones!
                </button>
            </div>
        </form>
    </div>

</div>
<script src="{{ asset('js/tmi.js') }}"></script>
<script src="{{ asset('js/twitch.js') }}"></script>

<div class="row">

    <div class="col-12 col-lg-6 {{ competition.isOpen ? 'offset-lg-3' : '' }}">
        <h1>Inscripciones</h1>
        <ul class="list-group list-group-flush sport-text mb-3 registrations">
            {% for registration in competition.registrations %}
                <li id="registration-{{ registration.id }}" class="list-group-item {{ registration.isConfirmed ? ' confirmed' : '' }}">
                    {{ registration.player.username }}
                    <span class="float-right">
                        {% if competition.isOpen %}
                            <form action="{{ path('registration_delete') }}" method="POST" class="d-inline">
                                <input type="hidden" name="registration_id" value="{{ registration.id }}">
                                <button class="fas fa-skull controls" type="submit" title="ban" onclick="if (!confirm('¿Estás seguro?')) return false"></button>
                            </form>
                            <form action="{{ path('toggle_confirmation') }}" method="POST" class="d-inline">
                                <input type="hidden" name="registration_id" value="{{ registration.id }}">
                                <input type="hidden" name="confirm" value="{{ registration.isConfirmed ? 0 : 1 }}">
                                <button class="controls" type="submit"
                                        title="{{ registration.isConfirmed ? 'Unconfirm' : 'Confirm' }}">
                                    <i class="far fa-square"></i>
                                    <i class="far fa-check-square"></i>
                                </button>
                        </form>
                        {% endif %}
                    </span>
                </li>
            {% endfor %}
        </ul>
    </div>

    {% if not competition.isOpen %}
        <div class="col-12 col-lg-6">
            <h1>Equipos</h1>
            {% for team in competition.teams %}
                <div class="my-2 bg-light border">
                    <div class="card-body">
                        <h5 class="card-title sport-text">{{ team.name }}</h5>
                        <ul class="list-group">
                            {% for player in team.players %}
                                <li class="list-group-item sport-text">{{ player.username }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

</div>
{% endblock %}
